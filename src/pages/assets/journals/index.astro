---
import DashLayout from "../../../layouts/DashLayout.astro";
import { hasAccess, accessProfiles } from "../../../lib/rbac";
import JournalList from "../../../components/user/assets/journal/JournalList";


// CHECK AUTHENTICATION AND ACCESS
const { userRoles, session } = Astro.locals;

const isAuthenticated: boolean = session !== null;

const hasPageAccess: boolean = hasAccess(
  userRoles,
  accessProfiles.programStart
);

// redirect if doesnt have access
if (!isAuthenticated || !hasPageAccess) {
  return Astro.redirect("/program");
}

const userId = session?.user.id;
if (!userId){
    return Astro.redirect("/auth/login")
}



// BREADCRUMBS
const breadcrumbs = [
  { name: "Home", url: "/" },
  { name: "Assets", url: "/assets" },
  { name: "Journal", url: "assets/journals"}

];
---

<DashLayout title="Journal" description="Main Journal page" breadcrumbItems={breadcrumbs}>

    {/* todo: Add block to create new journal entry */}
    <JournalList userId={userId} client:load />

</DashLayout>